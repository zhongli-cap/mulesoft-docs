= Mule Object Stores
:keywords: esb, object store, objects, persist

An *object store* is a facility for storing objects in Mule. Mule uses object stores whenever it needs data to persist for later retrieval. Internally, Mule uses object stores in various filters, routers, and other message processors that need to store state between messages. In most cases, Mule creates and manages object stores automatically, so no user configuration is necessary.

[NOTE]
====
To use the link:mule-user-guide/v/3.8/object-store-module-reference[object Store module] in Anypoint Studio, you must first download the *Object Store Connector* from the link:/mule-fundamentals/v/3.8/anypoint-exchange[Anypoint Exchange]. +
image:object-store-in-exchange.png[object store in exchange]
====

== Use Cases

In most cases, Mule creates and manages object stores for you, so no configuration is necessary. However, you may explicitly configure an object store in the following cases:

* When configuring an link:/mule-user-guide/v/3.8/idempotent-filter[idempotent message filter] or until a successful scope occurs.
* When configuring the link:/mule-user-guide/v/3.8/endpoint-configuration-reference#redelivery-policy[*Idempotent Redelivery Policy*] of a custom endpoint.

* When configuring an link:/mule-user-guide/v/3.8/splitter-flow-control-reference#aggregator-configuration[Aggregator], you can either use the two default built-in object stores or createa and reference your own.

* When configuring a custom component that must use an object store to persist information.
* When storing or retrieving information from a Mule flow through the Object Store module, link:http://mulesoft.github.io/objectstore-connector/1.3.3/apidocs/mule/objectstore-config.html[available as an extension].

Mule provides two types of object stores:

* *In-memory store* – Stores objects in local Mule runtime memory. Objects will be lost when the Mule runtime shuts down. 

* *Persistent store* – Mule persists data when an object store is explicitly configured to be persistent. In a stand-alone Mule runtime, Mule creates a default persistent store in the file system.

If you do not specify an object store, the default persistent object store is used.  

For more information, see "Object Stores and Clustering" in the link:/mule-user-guide/v/3.8/cache-scope[Cache Scope] document.

[TIP]
The default object store created for all new caching strategies supports cluster mode out of the box, with the exception of the cache scope which uses the old default caching strategy. For details, see the Object Stores and Clustering section in link:/mule-user-guide/v/3.8/cache-scope[Cache Scope].

== Adding Object Store Components

. Click the *X* icon in the Anypoint Studio taskbar to open Anypoint Exchange.
. Search for `Object Store` and click *Install*.
+
image:install+object+store+connector.png[install+object+store+connector]
+
This starts an installation Wizard.
+
. Search for the *Object Store Connector* and click *Install*.
. Click *Next*, then *Next* again. Accept the terms of the license agreement and click *Finish*.
. After installing the Object Store Connector into Studio, the connector is available in the Mule Palette by searching for `ObjectStore`.
. Drag the connector into your flow in the canvas. For example:
+
image:object-store-in-flow.png[object store in flow]
+
. Click the connector to access its properties editor.
+
image:object-store-properties-editor.png[object store properties editor]
+
. Click the green plus sign image:add.png[plus] to configure global settings for: +
Partition, Object Store Reference (to the object store bean), Entry time-to-live in milliseconds, Expiration interval, Maximum number of entries, and whether the storage is persistent. For more information, click in a field, and click the blue info icon:
+
image:info-icon.png[info-icon]
+
. Select one of the available operations from the drop-down menu:
+
[cols="30a,70a",options="header"]
|===
| Operation | Description
| *All keys* |
Sets the message payload to a list of all the keys in the object store. 

Throws an `UnsupportedOperationException` if the object store implementation does not support listing all keys. 

| *Contains* |
Checks whether the object store contains the given key. 

Sets the payload to true if the key exists in the object store, otherwise the payload is set to false. 
| *Dual store* |
Stores the value object using the supplied key, and also stores the key object using the supplied value. This is equivalent to calling `Store(key,value)` and `Store(value,key)` in a single operation.  

This allows you to later retrieve the key object by supplying the value object, instead of only retrieving the value object by supplying the key object.  

See the Store operation for more details. 
| *Remove* |
Lock the object store and remove the object for the respective key. throws an `ObjectDoesNotExistException` if the key does not exist in the object store.  

Sets the message payload to the object that was previously stored for the given key. f the key does not exist and ignoreNotExists is true the operation will return a null object.

Throws an `ObjectStoreException` if the given key is `null`,  if the store is not available, or if any other implementation-specific error occurrs. 
| *Retrieve* |
Retrieve an object from the object store and copy the retrieved value into the specified property scope of a Mule Message. The default target proprty scope is `INVOCATION`. 

Throws an `ObjectDoesNotExistException` exception if the key does not exist in the object store. 
| *Retrieve store* |
Retrieve and Store in the same operation.
| *Retrieve with lock* |
Lock the object store and retrieve the given value object for the supplied key object. The retrieved value is then copied into the specified property scope of a Mule Message. The object store lock is released after the object is retrieved from the object store. 
| *Store* |
Locks the object store and then writes the value object in the object store using the supplied key object. 

This operation does not change the current message payload. 

Throws an `ObjectAlreadyExistsException` if the overwrite property is set to false (the default) and the key already exists in the object store. 
|===
+
. Depending on the operation you select, different fields are available to configure the connector.

== XML Example

The following example demonstrates how to configure object stores in the following three situations:

. link:/mule-user-guide/v/3.8/idempotent-filter[idempotent filter] with an in-memory object store.
. idempotent filter with a persistent object store.
. Until a successful scope occurs with an in-memory object store.

[source, xml, linenums]
----
include::_sources/mule-object-stores.xml[]
----

== See Also

* Find out more about:
** link:http://mulesoft.github.io/objectstore-connector/1.3.3/apidocs/mule/objectstore-config.html[Object Store module], available as a Mule extension.
** link:http://mulesoft.github.io/objectstore-connector/[Object Store API].
* Learn about the link:/runtime-manager/managing-application-data-with-object-stores[CloudHub implementation of object stores].
* link:/mule-user-guide/v/3.8/object-store-module-reference[Object Store Module Reference].
* link:http://training.mulesoft.com[MuleSoft Training]
* link:https://www.mulesoft.com/webinars[MuleSoft Webinars]
* link:http://blogs.mulesoft.com[MuleSoft Blogs]
* link:http://forums.mulesoft.com[MuleSoft Forums]
