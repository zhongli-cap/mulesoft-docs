[[_oauth_dance]]
= Performing the OAuth dance with an OAuth enabled module

The final step for using the module is to actually trigger the OAuth dance. If you go back to 
<<_oauth_configuring, the section about configuring your OAuth enabled module>>, you'll see that there's a parameter called 
`authorizePath`. Through that parameter, the user configures the path of an automatically created Http endpoint which the user needs 
to hit with a browser in order to start the OAuth dance.

[TIP]
Remember that the Authorization Code grant type that the SDK supports right now, requires human interaction through a web browser.

== Multi Tenancy

Multi Tenancy for OAuth means being able to performe the OAuth dance multiple times, and associate each obtained token to a different
resource owner id.

The user needs to specify the resourceOwnerId that should be assigned to the token when the dance is initated. So suppose that 
the `authorizePath` has been set to `/authorize` and you want to perform a dance for the user `sdk_demo`. You should then hit the 
following http path: `/authorize?resourceOwnerId=sdk_demo`.

After the dance is compelted, you'll want to execute an operation using the access token that was obtained for that user. You will 
do that by using an expressions on the `resourceOwnerId` parameter of your module's config. A complete example would be this:

[source, xml, linenums]
----
<sfdc:config name="salesforce">
    <sfdc:oauth-connection display="PAGE" immediate="FALSE" prompt="CONSENT">
        <sfdc:oauth-authorization-code consumerKey="${sfdc.consumerkey}" consumerSecret="${sfdc.consumersecret}" 
        authorizationUrl="http://..." accessTokenUrl="http://..."/ localAuthorizationUrl="http://localhost:8080/.." 
        scope="this that and those" 
        resourceOwnerId="#[vars.ownerId]" /> // <1>
        <sfdc:oauth-callback-config listenerConfig="myHtttpListener" callbackPath="/callbackâ€ 
        authorizePath="/authorize" /> // <2> 
</sfdc:config>
----

<1> The `resourceOwnerId` parameter is set to an expression. Each time an OAuth protected operation is executed, that expression will be 
evaluated and the token associated to that value will be used
<2> We set the authorization endpoint authorizePath

=== Invalidating access tokens

Multi Tenancy implies the ability to invalidate the access token of a particular `resourceOwnerId`. This will cause the associated 
token information to be deleted.

To do this, the SDK automatically adds an operation called `unauthorize` to every OAuth enabled module. Resuming the example above, 
you could invalidate the obtained token with any of the following statements:

[source, xml, linenums]
----
<sfdc:unauthorize resourceOwnerId="sdk_demo" config-ref="salesforce" />
<!-- or -->
<sfdc:unauthorize resourceOwnerId="#[vars.resourceOwnerId]" config-ref="salesforce" />
----

== Next step

* <<_oauth_token_expiration, Handling expired access tokens>>