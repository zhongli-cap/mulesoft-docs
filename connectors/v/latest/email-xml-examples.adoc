= XML Examples for the Email Connector (Studio)
:keywords: email, connector, configuration, pop3
:toc:
:toc-title:

toc::[]

[[short_description]]
These examples show common Email connector configurations for XML configurations that define a Mule app.

[[email_xml_configs]]
== Email Connection Configurations

POP3 configuration example:
----
<email:pop3-config name="pop3Config">
   <email:pop3-connection
     host="pop.gmail.com" port="995"
     password="myPassword" user="my.account@gmail.com"/>
</email:pop3-config>
----

POP3S example with a TLS configuration:
----
<email:pop3-config name="mySecureConfig">
   <email:pop3s-connection host="127.0.0.1" port="995" password="myPassword" user="my.account@gmail.com">
       <tls:context enabledProtocols="TLSv1.2,SSLv3">
           <tls:trust-store path="greenmail.jks" password="changeit"/>
       </tls:context>
   </email:pop3s-connection>
</email:pop3-config>
----

IMAP configuration examples with Eagerly Fetch Content disabled:
----
<email:imap-config eagerlyFetchContent="false" name="email_imap">
    <email:imap-connection host="imap.gmail.com" password="changeme" user="me@gmail.com"/>
</email:imap-config>
----

IMAP configuration example with port 993 specified:
----
<email:imap-config name="imapConfig">
   <email:imap-connection host="imap.gmail.com" port="993" password="changeme" user="me@gmail.com"/>
</email:imap-config>
----

SMTP configuration examples:
----
<email:smtp-config name="smtpConfig">
   <email:smtp-connection
     host="smtp.gmail.com" port="465"
     password="myPassword" user="my.account@gmail.com"/>
</email:smtp-config>
----

----
<email:smtp-config name="senderConfig" defaultEncoding=”UTF-8”>
   <email:smtp-connection host="127.0.0.1" port="587"/>
</email:smtp-config>
----

== Operations

List operation: This example retrieves the body (`payload`) and subject (the `subject` attribute) of email. The List operation retrieves email through a configurable pagination process that defaults to `10` per page rather than retrieving all email at once.

----
<flow name=”retrieveEmails”>
<email:list-pop3 config-ref=”pop3Config”/>
  <foreach>
    <logger level=”INFO” message=”#[output application/java --- ‘Email body: $(payload)’]”/>
    <logger level=”INFO” message=”#[output application/java --- ‘Email subject: $(attributes.subject)’]”/>
  </foreach>
</flow>
----

Send operation: Sends email over SMTP.

----
<email:send config-ref="senderConfig" fromAdress=”sender.account@mulesoft.com”>
    <email:to-addresses>
        <email:to-address value="test.account@mulesoft.com"/>
    </email:to-addresses>

    <email:body>
        <email:content>Email Content</email:content>
    </email:body>

</email:send>
----

Store operation: Stores email to a local directory.

----
<email:store config-ref="config" mailboxFolder="INBOX" localDirectory="/Users/home”  emailID=”5” overwrite=”true”/>
----

Mark As Read operation:

----
<email:mark-as-read config-ref="imapConfig" emailId="123">
----

Mark As Deleted operation: Marks email for deletion by the Expunge operation.

----
<email:mark-as-deleted config-ref="imapConfig" emailId="123">
----

Expunge operation: Works on emails that are marked for deletion with the Mark As Deleted operation.

----
<email:expunge-folder config-ref="imapConfig" mailboxFolder="INBOX" >
----

Delete operation:

----
<email:delete config-ref="imapConfig" mailboxFolder="INBOX" emailId=”123”>
----

Attachments: TODO TODO You need to create a DataWeave map with the name of the attachments as keys and its values with the respective mime types.

----
<flow name="sendEmailWithAttachments">

   <set-variable variableName="json" value="#[output application/json --- {key: 'value'}]" mimeType="application/json"/>
   <set-variable variableName="textPlain" value="This is the email text attachment" mimeType="text/plain"/>
   <set-variable variableName="octetStream" value="#[myBinaryVariable]" mimeType="application/octet-stream"/>

   <email:send config-ref="senderConfig" subject="This is the email subject">
       <email:to-addresses>
           <email:to-address value="test.account@mulesoft.com"/>
       </email:to-addresses>
----

== About Sending Email Over SMTP

To send an email, you need an SMTP configuration element, such as this one:

----
<email:smtp-config name="senderConfig" defaultEncoding=”UTF-8”>
   <email:smtp-connection host="127.0.0.1" port="587"/>
</email:smtp-config>
----

The `defaultEncoding` applies to all emails that are sent using this configuration. However, you can override this encoding with the Send operation. If `defaultEncoding` is not specified in the configuration, the app will use the default Mule Runtime encoding.

A simple email looks something like this:

<email:send config-ref="senderConfig" fromAdress=”sender.account@mulesoft.com”>
  <email:to-addresses>
    <email:to-address value="test.account@mulesoft.com"/>
  </email:to-addresses>
  <email:body>
    <email:content>Email Content</email:content>
  </email:body>
</email:send>

If you always want to send emails from the same account, you can specify a `from` address in the `smtp-config` element instead of specifying it within each operation, for example:

----
<email:smtp-config name="senderConfigWithAddress" from=”sender.account@mulesoft.com”>
   <email:smtp-connection host="127.0.0.1" port="587"/>
</email:smtp-config>

<email:send config-ref="senderConfigWithAddress">
  <email:to-addresses>
    <email:to-address value="receiverOne@mulesoft.com"/>
    <email:to-address value="receiverTwo@mulesoft.com"/>
  </email:to-addresses>
  <email:body>
    <email:content>Email Content</email:content>
  </email:body>
</email:send>
----

You can also override the `from` address in the SMTP configuration from a Send operation in your flow.


=== Advanced SMTP Configuration Parameters

In this example, the addresses (`to-address`, `cc-address`, `bcc-address` and `reply-to-address`) are lists of destination addresses. You can add as many as you like and leave empty any address fields you do not need hem.

----
<flow name="sendEmail">

   <set-variable variableName="json" value="#[output application/json --- {key: 'value'}]" mimeType="application/json"/>

   <email:send config-ref="senderConfig" subject="This is the email subject">
       <email:to-addresses>
           <email:to-address value="test.account@mulesoft.com"/>
           <email:to-address value="other.test.account@mulesoft.com"/>
       </email:to-addresses>

       <email:cc-addresses>
           <email:cc-address value="cc.account1@mulesoft.com"/>
           <email:cc-address value="cc.account2@mulesoft.com"/>
       </email:cc-addresses>

       <email:bcc-addresses>
           <email:bcc-address value="bcc.account1@mulesoft.com"/>
           <email:bcc-address value="bcc.account2@mulesoft.com"/>
           <email:bcc-address value="bcc.account3@mulesoft.com"/>
       </email:bcc-addresses>

       <email:reply-to-addresses>
          <email:reply-to-address value="reply.to.account@mulesoft.com"/>
       </email:reply-to-addresses>

       <email:headers>
          #[{‘My custom header’: ‘Header value’}]
       </email:headers>

       <email:body contentType="text/plain" encoding=”UTF-8” contentTransferEncoding=”7BIT”>
          <email:content>Email Content</email:content>
       </email:body>

      <email:attachments>#[
        {
          'json-attachment' : json
        }]
      </email:attachments>

   </email:send>
</flow>
----

In the email body, `contentTransferEncoding` indicates how transferred email is encoded. For more information, see the email RFC  (link::https://www.ietf.org/rfc/rfc2045.txt[Multipurpose Internet Mail Extensions (MIME) Part One:Format of Internet Message Bodies]).

Headers (`headers`): A custom set of headers that are bound with the email. This parameter must be constructed through a DataWeave expression.

Attachments (`attachments`): Email attachments are bound with the email.

Content Transfer Encoding (`AttachmentContentTransferEncoding`): Transfer encoding used to send the email attachments. Base64 is recommended for large payloads.


// How do you get the ID? How/why would you ever know it?

[[see_also]]
== See Also

include::include_link_list.adoc[tags=email-connector]

include::include_link_list.adoc[tags=tech-ref-email]
