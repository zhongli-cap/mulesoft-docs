= To Write Mapped Content to a File
:keywords: file, ftp, connector, operation
:toc:
:toc-title:

toc::[]

// For Anypoint Studio, Design Center: FTP connector

This example reads a JSON file from an FTP server, then writes a subset of that JSON content to a new file on the FTP server. It uses DataWeave to map fields from the source file to fields in the destination file and to provide a name for the file that includes a timestamp.

. Provide a Scheduler trigger for your flow with a Fixed Frequency of every 30 seconds (where Frequency = 30 and Time Unit = Seconds).
+
. Set up a Read operation for the FTP connector:
.. Set up or select a configuration for the FTP connector.
+
You can set up an <<see_also,FTP or SFTP configuration>>.
+
.. Provide the File Path to a JSON file.
+
Example: `/full_record.json`
+
Assume that the JSON content has several records that look something like this:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "address": {
      "street": "Kulas Light",
      "suite": "Apt. 556",
      "city": "Gwenborough",
      "zipcode": "92998-3874",
      "geo": {
        "lat": "-37.3159",
        "lng": "81.1496"
      }
    },
    "phone": "1-770-736-8031 x56442",
    "website": "hildegard.org"
  },
  {
    "id": 2,
    "name": "Ervin Howell",
    "username": "Antonette",
    "email": "Shanna@melissa.tv",
    "address": {
      "street": "Victor Plains",
      "suite": "Suite 879",
      "city": "Wisokyburgh",
      "zipcode": "90566-7771",
      "geo": {
        "lat": "-43.9509",
        "lng": "-34.4618"
      }
    },
    "phone": "010-692-6593 x09125",
    "website": "anastasia.net"
  }
]
----
+
. After the Read operation, configure a Write operation for the FTP connector:
.. Continue to use the same FTP connection configuration that you used for the Read operation.
.. Provide a Path to a new JSON file.
+
Example: `#['partial_record_' ++ now() ++ '.json']`
+
Note that the file name here includes a timestamp (for example, `partial_record_2017-06-23T06:38:27.232Z.json`) that is built from a `now()` operation in a DataWeave expression. The timestamp provides a unique name for each file that the Write operation creates.
+
.. Delete the value `payload` from the Content field.
+
In subsequent steps, you will populate this field with a DataWeave expression that maps JSON content from your input file to a new output format.
+
. Set the Write Mode to Create New, and enable the Lock.
+
Each time the Scheduler triggers the flow, the Write operation will create a new file.
+
. Follow the next set of steps on the Write operation to provide a mapping between JSON input and output examples:
.. After clicking Map and then clicking the Sample Data tab at the bottom of the Content mapping window, add a JSON sample that looks like this:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "address": {
      "street": "Kulas Light",
      "suite": "Apt. 556",
      "city": "Gwenborough",
      "zipcode": "92998-3874",
      "geo": {
        "lat": "-37.3159",
        "lng": "81.1496"
      }
    },
    "phone": "1-770-736-8031 x56442",
    "website": "hildegard.org"
  }
]
----
+
.. At the bottom of the Input column in the Content mapping window, click the Custom Data Type icon:
+
image:icon_custom_data_type.png[Customize Data Type icon]
+
.. Provide a JSON data type example with a name such as `My JSON Input`:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "address": {
      "street": "Kulas Light",
      "suite": "Apt. 556",
      "city": "Gwenborough",
      "zipcode": "92998-3874",
      "geo": {
        "lat": "-37.3159",
        "lng": "81.1496"
      }
    },
    "phone": "1-770-736-8031 x56442",
    "website": "hildegard.org"
  }
]
----
+
Be sure to Apply Changes to save your data type.
+
.. At the bottom of the Output column in the Content mapping window, click the Custom Data Type icon for the output, and provide a JSON data type example with a name such as `My JSON Output`:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "website": "hildegard.org"
  }
]
----
+
Notice that this output example provides a subset of the full input example. Be sure to Apply Changes.
+
.. In the Content mapping window, connect the Input fields to the Output fields.
+
Ignore all Input fields that do not have corresponding Output fields. The mapping will look like this when you are done:
+
image::ftp_read_map.png[FTP Read Operation Mapping]
+
.. From the Source tab at the bottom of the Content mapping window, make sure your source looks like this:
+
----
%dw 2.0

output application/json
---
(payload map (value0) -> {
    "id": value0.id,
    "name": value0.name,
    "username": value0.username,
    "email": value0.email,
    "website": value0.website
  })
----
+
The source populates the Content field in the Configuration tab.
+
Note that you can change `(value0, index0)` to `(value0)` because the `index0` key is not needed for this transformation.
+
. Add a Logger to the end of your flow with a Message that matches your data mapping:
+
----
(payload map (value0) -> {
    "id": value0.id,
    "name": value0.name,
    "username": value0.username,
    "email": value0.email,
    "website": value0.website
  })
----
. Sync your application.
. Once your application is running, check the Logs for the mapped content that prints each time the Scheduler triggers the flow.
+
In the Logs, file content appears as INFO on a single line.
+
[Optional] You can use a locally hosted FTP client, such a FileZilla, to see the new JSON files that the Write operation creates on your FTP server.
+
The content looks like this:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "website": "hildegard.org"
  },
  {
    "id": 2,
    "name": "Ervin Howell",
    "username": "Antonette",
    "email": "Shanna@melissa.tv",
    "website": "anastasia.net"
  }
]
----

[[see_also]]
== See Also

include::include_link_list.adoc[tags=ftp-set-up]

include::include_link_list.adoc[tags=sftp-set-up]

include::include_link_list.adoc[tags=perform-basic-file-ops]

include::include_link_list.adoc[tags=ftp-connector]

include::include_link_list.adoc[tags=tech-ref-ftp]
