= Example: Dynamic Routing with the VM Connector
:keywords: VM, queues, connector, publish, listen, dynamic routing
:toc:
:toc-title:

toc::[]

We can also use expressions to have a generic flow which sends messages to different queues depending on certain conditions.

For instance, we could make link:/connectors/vm-publish-listen[the publish and listen example] more interesting by also using an expression in the queueName attribute.

Suppose that the json object that we get through the Http connector also includes a destination object which maps directly with the name of the queue we need to write to. We would then do the following:

[source, xml]
----
    <flow name="publish">
        <http:listener path="/json-here" allowedMethods="POST" config-ref="httpListener" />
        <vm:publish queueName="#[payload.destination]">
            <vm:content>#[payload.body]</vm:content>
        </vm:publish>
        <logger/>
    </flow>
----
