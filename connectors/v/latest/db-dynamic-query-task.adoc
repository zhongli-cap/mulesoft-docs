= To Query Data Dynamically

This procedure shows you how to query tables dynamically. You use one table name and then another in the URL to trigger the app. A query substitutes a DataWeave expression for a database object name. For example, in the SELECT statement in this procedure, you use a variable expression to represent a dynamic table name in the FROM clause. In a WHERE clause, using a variable expression to represent different parameter values invites trouble: SQL injection. To write queries to represent different parameter values, use the input parameter syntax: `:<value>`

This procedure builds on the example that connects a Mule app to a database using the Classic Models sample database. 

. Create a new project and in the new flow, add the HTTP Listener connector. In a Connector configuration, accept an existing configuration or add one as follows:
+
* Protocol: Select HTTP.
* Host: *0.0.0.0*
* Port: *8081*
+
. In General, set Path to the path of the HTTP URL, for example, set Path to */*, and accept the other default listener settings. Close the connector.
. Add the Transformer component to the flow, and declare a variable:
+
* In Transform, on the Mappings tab, select Output Payload > Add Transformation.
+
* In Type, select Variable.
+
* In Name, enter a variable name, for example *cm_table*.
+
* Click Create.
+
* In the center of the Mappings pane, click Customize Data Type.
+
* In Transform, in Data Type for Variables cm_table, select New Data Type.
+
* In Name, enter a type name, for example *tablename*.
+
* In Format, accept the default, JSON.
+
* In Type, select From Example and enter an example of a database name. For example, type the following string in quotation marks:
+
*"productlines"*
+
. Set the variable to an expression based on how you intend to trigger the app. For example, on the Source tab, in Transformation Source, enter the following DataWeave code to set the variable to a query parameter that you plan to include in the URL trigger:
+
----
%dw 1.0

%output application/java  
---
{
  "cm_table": attributes.queryParams
}
----
+
. Add a database connector to the flow, and set up a classicmodels database for a Select operation.
. In Database - Select, in General, click image:function-key.png[f of x key]. 
+
Enter SQL query text, the concatenation operator, and an expression that represents the variable. For example:
+
*'SELECT * FROM ' ++ attributes.queryParams.cm_table*
+
. Click Run or Sync. Trigger the app:
+
* Select Running > Copy Link.
+
* Paste the link in a browser or client, such as Postman.
+
* To the URL, add an HTTP query parameter that sets the variable name equal to a table name. For example:
+
`+https://...cloudhub.io/?cm_table=productlines+`
+
The HTTP listener hears the request, starts the app, and a file, which you can delete, containing the binary query results is downloaded from the browser to your localhost. 
+
. Open the database connector and select Output.
+
The results of querying the productlines table appear in JSON format.
+
. Repeat the previous two steps using a different table name, for example:
+
`+https://...cloudhub.io/?cm_table=payments+`
+
The results of querying the payments table appear when you select Output.

== See Also

* link:/connectors/db-filter-query-task[To Filter a Query Using an Input Parameter]
* link:/connectors/http-trigger-app-from-browser[To Trigger an App from a Browser]
* link:/connectors/db-connect-database[To Connect a Database]
* link:http://www.mysqltutorial.org/download/2[Classic Models database download]
