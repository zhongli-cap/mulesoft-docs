= To Configure the NetSuite Connecter in Studio

*Examples:* link:/connectors/netsuite-studio-examples[NetSuite Connector Examples in Studio]

. Click the Global Elements tab at the base of the canvas.
. On the Global Mule Configuration Elements screen, click Create.
. In the "Choose Global Type" wizard, expand  Connector Configuration, and then select  NetSuite: Login Authentication, NetSuite: Request Level Authentication, NetSuite: SSO Login Authentication, or NetSuite: Request Level Token Based Authentication depending on your NetSuite authentication.
+
image:netsuite_configurations.png[NetSuite Configuration Options]
+
[%header,cols="40%,60%"]
|===
|Configuration |Description
|Login Authentication |Makes use of the SuiteTalk's login API call on the first request sent by the connector to establish a session with NetSuite.
|Request Level Authentication |Using this strategy, you can send user credentials in the SOAP header of each request instead of authenticating to NetSuite by invoking login.
|Single Sign-On Login Authentication |This is a token based authentication system that avoids the use of environment username and password. Here you supply a privateKey together with other information. The connector is then responsible for generating an authentication token and establishing a session with NetSuite via the `ssoLogin` API call on the first request.
|Request Level Token Based Authentication |Similar to Single Sign-On Login Authentication, this is a token based authentication system. However, instead of using a privateKey generated via openssl, this uses a consumer and token key/secret pairs which are established within the NetSuite environment.
|===
+
. Click Ok.
. Enter global element properties.


== To Set Up Login Authentication and Request Level Authentication

[%header,cols="30%,70%"]
|===
|Parameter |Description
|Name |Enter a name for the configuration with which to reference it later.
|Email |Enter the login email of the NetSuite UI.
|Password |Enter the corresponding password to log into NetSuite.
|Account |Enter the account ID of the SuiteTalk NetSuite web services. This is usually found within NetSuite sandbox UI under Setup > Integration > Web Service Preferences.
|Role Id |Enter the role ID for the user in SuiteTalk, which determines the Processor privileges.
|Application Id |Enter the application ID corresponding to the Integration record to be used.
|Connection Timeout |Enter the amount of time, in milliseconds, that the client must attempt to establish a connection before timing out.
|Receive Timeout |Enter the amount of time, in milliseconds, that the client must wait for a response before timing out.
|Enable DataSense |If you select this option, DataSense extracts metadata for NetSuite standard objects to automatically determine the data type and format that your application must deliver to, or can expect from, NetSuite. 
|Endpoint a|
Enter the URL of the service endpoint.

Make sure that the endpoint uses the version of NetSuite that the connector supports.

The Endpoint URL must be defined for all configurations. The hostname is specific to the Account ID of the user. The rest of the URL contains the API version. Also note that every connector version only supports one version of the SuiteTalk API.

|Separator |Enter the separator used to support the keys that are required to provide a better support for custom fields.
|===

== To Set Up SSO Login Authentication 

To use the SSO Login Authentication, enable this feature in your sandbox environment using NetSuite Support. NetSuite provides an SSO Kit and information on how to proceed with setting up private and public keys for use in generating authentication tokens. They also provide you with a Partner ID. After this setup is established, a mapping has to be created between the standard NetSuite credentials, the partner ID, company ID, and user ID. A developer or administrator should perform this mapping. It is not handled by the connector and it is only done once for each user ID that is allowed to authenticate using SSO within your company.

For this mapping, start by generating a token using the SSO Kit provided by NetSuite. To establish the mapping, invoke the SuiteTalks Web Service API call `mapSso` using an external Java application or any other method of your choice. A sample SOAP request of the `mapSso` API call looks as follows:

[source, xml, linenums]
----
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:messages_2015_1.platform.webservices.netsuite.com" xmlns:urn1="urn:core_2015_1.platform.webservices.netsuite.com">
   <soapenv:Header></soapenv:Header>
   <soapenv:Body>
      <urn:mapSso>
         <urn:ssoCredentials>
            <urn1:email>Your NetSuite email</urn1:email>
            <urn1:password>Your NetSuite password</urn1:password>
            <urn1:account>Your NetSuite account Id</urn1:account>
            <urn1:role internalId="The account role Id"></urn1:role>
            <urn1:authenticationToken>
                The token string generated using the SSO kit
            </urn1:authenticationToken>
            <urn1:partnerId>Your NetSuite partner Id</urn1:partnerId>
         </urn:ssoCredentials>
      </urn:mapSso>
   </soapenv:Body>
</soapenv:Envelope>
----

[%header,cols="30%,70%"]
|===
|Parameter |Description
|Name |Enter a name for the configuration so it can be referenced later.
|Partner ID |Enter the partner ID used in the mapping process.
|Partner Account |Enter the account ID of the SuiteTalk NetSuite web services.
|Company ID |Enter the company ID used in the mapping process for the connector to generate a token.
|User ID |Enter the user ID used in the mapping process for the connector to generate a token.
|Key File |Enter the privateKey file name to pick up from the project. This file should be the .der file generated as per NetSuite’s specifications. This is used to encrypt the company ID and user ID into a token for ssoLogin.
|Application Id |Enter the application ID corresponding to the Integration record to be used.
|Connection Timeout |Enter the amount of time, in milliseconds, that the client must attempt to establish a connection before timing out.
|Receive Timeout |Enter the amount of time, in milliseconds, that the client must wait for a response before timing out.
|Enable DataSense |If you select this option, DataSense extracts metadata for NetSuite standard objects to automatically determine the data type and format that your application must deliver to, or can expect from, NetSuite. 
|Endpoint |Enter the URL of the service endpoint. 
The Endpoint URL must be defined for all configurations. The hostname is specific to the Account ID of the user. The rest of the URL contains the API version. Also note that every connector version only supports one version of the SuiteTalk API.
|Separator |Enter the separator used to support the keys that are required to provide a better support for custom fields.
|Required Libraries |Click Add File to add the SSO jar that you acquire via NetSuite support.
|===

== To Set Up Request Level Token Based Authentication

To use this authentication mechanism, set up an Integration Record within NetSuite and enable Token Based Authentication. This generates a consumer key and secret for you.

Set up an access token from within your NetSuite environment that combines the Integration Record with a user. This assumes that your NetSuite account has the required permissions enabled to generate the tokens.

Refer to the NetSuite Help Center or SuiteAnswers for detailed information on how to navigate NetSuite and set this up.

[%header,cols="30%,70%"]
|===
|Parameter |Description
|Consumer Key |Enter the consumer key value for the token based authentication enabled integration record being used.
|Consumer Secret |Enter the consumer secret value for the token based authentication enabled integration record being used.
|Token ID |Enter the token ID representing the unique combination of a user and integration generated within the NetSuite environment.
|Token Secret |Enter the respective token secret for the user/integration pair.
|Account |Enter the account ID of the SuiteTalk NetSuite web services. This is usually found within NetSuite sandbox UI under Setup > Integration > Web Service Preferences.
|Connection Timeout |Enter the amount of time, in milliseconds, that the client must attempt to establish a connection before timing out.
|Receive Timeout |Enter the amount of time, in milliseconds, that the client must wait for a response before timing out.
|Enable DataSense |If you select this option, DataSense extracts metadata for NetSuite standard objects to automatically determine the data type and format that your application must deliver to, or can expect from, NetSuite. 
|Endpoint a|
Enter the URL of the service endpoint.

Make sure that the endpoint uses the version of NetSuite that the connector supports.

The Endpoint URL must be defined for all configurations. The hostname is specific to the Account ID of the user. The rest of the URL contains the API version. Also note that every connector version only supports one version of the SuiteTalk API.

|Separator |Enter the separator used to support the keys that are required to provide a better support for custom fields.
|===

== To Set Up the NetSuite Namespace and Schema

In Anypoint Studio, when you drag the NetSuite connector from the palette to the Anypoint Studio canvas, Studio populates the XML code with the connector namespace and schema location for you. However, if you are using the XML editor or creating a standalone use the connector, you need to add the namespace and schema location to your application.

* Namespace: `http://www.mulesoft.org/schema/mule/netsuite`
* Schema Location: `http://www.mulesoft.org/schema/mule/netsuite/current/mule-netsuite.xsd`

If you are manually coding the Mule application in Studio's XML editor or other text editor, define the namespace and schema location in the header of your Configuration XML, inside the `<mule>` tag.

[source, xml,linenums]
----
<mule xmlns="http://www.mulesoft.org/schema/mule/core"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:netsuite="http://www.mulesoft.org/schema/mule/netsuite"
      xsi:schemaLocation="
               http://www.mulesoft.org/schema/mule/core
               http://www.mulesoft.org/schema/mule/core/current/mule.xsd
               http://www.mulesoft.org/schema/mule/netsuite
               http://www.mulesoft.org/schema/mule/netsuite/current/mule-netsuite.xsd">

      <!-- put your global configuration elements and flows here -->

</mule>
----

Examples of NetSuite global configurations:

[source, xml, linenums]
----
<!-- Login Authentication -->
<netsuite:config-login-authentication name="NetSuite" email="${email}" password="${password}" account="${account}" roleId="${roleId}" applicationId="${applicationId}"/>

<!-- Request Level Authentication -->
<netsuite:config-request-level-authentication name="NetSuite" email="${email}" password="${password}" account="${account}" roleId="${roleId}" applicationId="${applicationId}"/>

<!-- Request Level Token Based Authentication -->
<netsuite:config-request-level-token-based-authentication name="NetSuite" consumerKey="${consumerKey}" consumerSecret="${consumerSecret}" tokenId="${tokenId}" tokenSecret="${tokenSecret}" account="${account}" />

<!-- SSO Login Authentication -->
<netsuite:config-sso-login-authentication name="NetSuite" email="${email}" password="${password}" account="${account}" roleId="${roleId}" applicationId="${applicationId}"/>
----

== To Use the Connector in a Mavenized Mule App

If you are coding a Mavenized Mule application, this XML snippet must be included in your `pom.xml` file.

[source,xml,linenums]
----
<dependency>
    <groupId>org.mule.modules</groupId>
    <artifactId>mule-module-netsuite</artifactId>
    <version>7.4.0</version>
</dependency>
----

== To Make RESTlet Calls

NetSuite RESTlets allow you to develop custom RESTful web services for your NetSuite account using JavaScript and SuiteScript.
The example calls a script deployed as a RESTlet via the GET method. Here, we are attempting to get the CUSTOMER record with id = 700 using the RESTlet with script = 546 and deploy = 1.

image:netsuite_flow_restlet_calls.png[RESTlet Calls Flow]

[source,xml,linenums]
----
<flow name="restletGet">
    <http:listener config-ref="HTTP_Listener_Configuration" path="/get" doc:name="/get"/>
    <dw:transform-message doc:name="Transform GET Input">
        <dw:set-payload><![CDATA[%dw 1.0
%output application/java
---
{
"id": "700",
"recordtype": "customer"
}]]></dw:set-payload>
    </dw:transform-message>
    <netsuite:call-restlet-get config-ref="NetSuite__Request_Level_Authentication" deploy="1" script="546" doc:name="NetSuite RESTlet (GET)"/>
    <json:object-to-json-transformer doc:name="Map to JSON"/>
    <logger level="INFO" doc:name="Logger"/>
</flow>
----

== To Use DataWeave

The NetSuite connector’s DataSense capability coupled with that of DataWeave via the Transform Message component makes integrating with your NetSuite environment straightforward. For the following two examples, we use a JSON input string and extract the necessary data from it to form our NetSuite request.

This example code adds a Journal Entry to NetSuite from the following JSON input:

[source,dataweave,linenums]
----
{
   "tranId":"SampleJournal123",
   "subsidiary":{
      "internalId":"1"
   },
   "customFieldList":{
      "customField":[
         {
            "StringCustomFieldRef__custbodytestbodyfield":"Sample Transaction Body Custom Field"
         }
      ]
   },
   "lineList":{
      "line":[
         {
            "account":{
               "internalId":"1"
            },
            "debit":100.0,
            "customFieldList":{
               "customField":[
                  {
                     "SelectCustomFieldRef__custcol_far_trn_relatedasset":{
                         "internalId":"1"
                     }
                  },
                  {
                     "StringCustomFieldRef__custcoltestcolumnfield": "Sample Transaction Column Custom Field 1"
                  }
               ]
            }
         },
         {
            "account":{
               "internalId":"1"
            },
            "credit":100.0,
            "customFieldList":{
               "customField":[
                  {
                     "SelectCustomFieldRef__custcol_far_trn_relatedasset":{
                         "internalId":"2"
                     }
                  },
                  {
                     "StringCustomFieldRef__custcoltestcolumnfield": "Sample Transaction Column Custom Field 2"
                  }
               ]
            }
         }
      ]
   }
}
----


The "add operation for the connector expects a Map as input. Here is the DataWeave script to paste into the Transform Message DataWeave editor:

[source,dataweave,linenums]
----
%dw 1.0
%output application/java
---
{
	customFieldList: payload.customFieldList,
	lineList: payload.lineList,
	subsidiary: payload.subsidiary,
	tranId: payload.tranId
}
----

In this example, we use the same scenario for basic search as described in the previous section. However, instead of constructing the criteria in a java component, we transform a JSON string:


[source,dataweave,linenums]
----
{
   "companyName": {
      "operator": "STARTS_WITH",
      "searchValue": "A"
   },
   "isPerson": false,
   "priority": {
      "operator": "EQUAL_TO",
      "searchValue": 50
   }
}
----

Here is the DataWeave script to paste into the Transform Message DataWeave editor:

[source,dataweave,linenums]
----
%dw 1.0
%output application/java
---
{
	customFieldList: {
		customField: [{
			scriptId: "custentity_cust_priority",
			operator: payload.priority.operator,
			searchValue: payload.priority.searchValue
		} as :object {
			class : "com.netsuite.webservices.platform.core.SearchLongCustomField"
		}]
	} as :object {
		class : "com.netsuite.webservices.platform.core.SearchCustomFieldList"
	},
	companyName: {
		operator: payload.companyName.operator,
		searchValue: payload.companyName.searchValue
	} as :object {
		class : "com.netsuite.webservices.platform.core.SearchStringField"
	},
	isPerson: {
		searchValue: payload.isPerson
	} as :object {
		class : "com.netsuite.webservices.platform.core.SearchBooleanField"
	}
} as :object {
	class : "com.netsuite.webservices.platform.common.CustomerSearchBasic"
}
----

== To Use Search Operations

In NetSuite, the search operation can be used to execute a Basic Search, Joined Search, or an Advanced Search. To this end, you need to instantiate one of these three search types for the record type you want to query:

[%header,cols="30a,70a"]
|===
|Search Operation |Description
|`<Record>SearchBasic`|Used to execute a search on a record type based on search filter fields that are specific to that type.
|`<Record>Search` +
|Used to execute a search on a record type based on search filter fields specific to that type and others that are associated with a related record type.
|`<Record>SearchAdvanced` +
|Used to execute a search on a record type in which you specify search filter fields and/or search return columns or joined search columns. Using advanced search, you can also return an existing saved search.
|===

This also applies for the asynchronous equivalent of search, the `asyncSearch` operation.

=== Search Pagination Support

Support for pagination was added to `search` for NetSuite connector version 7.0.0.

The connector's search capability is now unified under one operation. Other search-related processors have been removed. Thus, `search` always retrieves the whole set of results. Therefore users do not need to work with `searchNext` or `searchMore` in order to get the rest of the records from subsequent pages. The return type is also different; the processor will output a List of Maps representing each and every record obtained by your search criteria.

An important aspect to note is that pagination could not be applied to the asynchronous equivalent of `search` (`asyncSearch`). This is due to the fact that the actual pagination would have to be applied to the `getAsyncResult` operation. This would mean that only the first page would end up being retrieved asynchronously. Furthermore, `getAsyncResult` is common to all async operations. Hence we cannot even apply pagination here since the return type of this operation depends on what async operation was invoked.

Regarding the new search configuration, the connector is the same apart from a new attribute called `fetchSize`:

[source, xml, linenums]
----
<netsuite:paged-search config-ref="NetSuite__Login_Authentication"
    searchRecord="CUSTOMER_BASIC"
    fetchSize="5"
    doc:name="Customer Basic Search"/>
----

=== ItemSearchAdvanced and ReturnSearchColumns

When using `search` the connector  outputs a list of maps representing the Record objects returned by your `search` operation. If using an advanced search and the `returnSearchColumns` flag is set to true, NetSuite returns a `SearchRowList` containing the search results. The connector would then be responsible for mapping `SearchRows` into the corresponding `Record` type object in order to facilitate usability.

However, in the case of `ItemSearchAdvanced` the connector does not do this mapping and provides the user with the SearchRows. This is the case due to the fact that ITEMs in NetSuite can be of various types and we cannot assume the item type from an `ItemSearchRow`. This issue can also occur with any other record type that behaves similar to `ITEM`, but we are not aware of others.

== To Use Custom Field DataSense

In NetSuite, you can add different types of custom fields and have these customizations apply to different record types. With DataSense enabled, the NetSuite connector retrieves and shows these fields. Note however that we do not fully support all the customization types that NetSuite users are able to define.
The following lists outline what fields we do and do not handle, and where they appear in relation to the record type's attributes. For the most part you can see that customizations are usually present within a list field called _customFieldList_, but in some cases these might reside elsewhere.

=== Entity Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|CONTACT |Contact > customFieldList > customField
|CUSTOMER |Customer > customFieldList > customField
|EMPLOYEE |Employee > customFieldList > customField
|ENTITY_GROUP |EntityGroup > customFieldList > customField
|PARTNER |Partner > customFieldList > customField
|PROJECT_TASK |ProjectTask > customFieldList > customField
|VENDOR |Vendor > customFieldList > customField
|===

=== Item Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|ASSEMBLY_ITEM |AssemblyItem > customFieldList > customField
|ENTITY_GROUP |EntityGroup > customFieldList > customField
|INVENTORY_ITEM |InventoryItem > customFieldList > customField
|KIT_ITEM |KitItem > customFieldList > customField
|NON_INVENTORY_PURCHASE_ITEM |NonInventoryPurchaseItem > customFieldList > customField
|NON_INVENTORY_RESALE_ITEM |NonInventoryResaleItem > customFieldList > customField
|NON_INVENTORY_SALE_ITEM |NonInventorySaleItem > customFieldList > customField
|OTHER_CHARGE_PURCHASE_ITEM |OtherChargePurchaseItem > customFieldList > customField
|OTHER_CHARGE_RESALE_ITEM |OtherChargeResaleItem > customFieldList > customField
|OTHER_CHARGE_SALE_ITEM |OtherChargeSaleItem > customFieldList > customField
|SERVICE_PURCHASE_ITEM |ServicePurchaseItem > customFieldList > customField
|SERVICE_RESALE_ITEM |ServiceResaleItem > customFieldList > customField
|SERVICE_SALE_ITEM |ServiceSaleItem > customFieldList > customField
|===

=== CRM Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|CALENDAR_EVENT |CalendarEvent > customFieldList > customField
|CAMPAIGN |Campaign > customFieldList > customField
|ISSUE |Issue > customFieldList > customField
|MANUFACTURING_OPERATION_TASK |ManufacturingOperationTask > customFieldList > customField
|PHONE_CALL |PhoneCall > customFieldList > customField
|PROJECT_TASK |ProjectTask > customFieldList > customField
|SOLUTION |Solution > customFieldList > customField
|SUPPORT_CASE |SupportCase > customFieldList > customField
|TASK |Task > customFieldList > customField
|===

=== Transaction Body Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|ASSEMBLY_BUILD |AssemblyBuild > customFieldList > customField
|CASH_SALE |CashSale > customFieldList > customField
|CUSTOMER_PAYMENT |CustomerPayment > customFieldList > customField
|DEPOSIT |Deposit > customFieldList > customField
|ESTIMATE |Estimate > customFieldList > customField
|EXPENSE_REPORT |ExpenseReport > customFieldList > customField
|INVENTORY_ADJUSTMENT |InventoryAdjustment > customFieldList > customField
|INVOICE |Invoice > customFieldList > customField
|ITEM_FULFILLMENT |ItemFulfillment > customFieldList > customField
|ITEM_RECEIPT |ItemReceipt > customFieldList > customField
|JOURNAL_ENTRY |JournalEntry > customFieldList > customField
|OPPORTUNITY |Opportunity > customFieldList > customField
|PURCHASE_ORDER |PurchaseOrder > customFieldList > customField
|PURCHASE_REQUISITION |PurchaseRequisition > customFieldList > customField
|SALES_ORDER |SalesOrder > customFieldList > customField
|TRANSFER_ORDER |TransferOrder > customFieldList > customField
|VENDOR_BILL |VendorBill > customFieldList > customField
|VENDOR_CREDIT |VendorCredit > customFieldList > customField
|VENDOR_PAYMENT |VendorPayment > customFieldList > customField
|VENDOR_RETURN_AUTHORIZATION |VendorReturnAuthorization > customFieldList > customField
|WORK_ORDER |WorkOrder > customFieldList > customField
|===

=== Transaction Column Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|CASH_SALE |CashSale > itemList > item > customFieldList > customField
|ESTIMATE |Estimate > itemList > item > customFieldList > customField
|EXPENSE_REPORT |ExpenseReport > expenseList > expense > customFieldList > customField
|INVOICE |Invoice > itemList > item > customFieldList > customField
|ITEM_FULFILLMENT |ItemFulfillment > itemList > item > customFieldList > customField
|ITEM_RECEIPT |ItemReceipt > itemList > item > customFieldList > customField
|JOURNAL_ENTRY |JournalEntry > lineList > line > customFieldList > customField
|OPPORTUNITY |Opportunity > itemList > item > customFieldList > customField
|PURCHASE_ORDER |PurchaseOrder > itemList > item > customFieldList > customField
|PURCHASE_REQUISITION |PurchaseRequisition > itemList > item > customFieldList > customField
|SALES_ORDER |SalesOrder > itemList > item > customFieldList > customField
|TIME_BILL |TimeBill > customFieldList > customField
|TRANSFER_ORDER |TransferOrder > itemList > item > customFieldList > customField
|VENDOR_BILL |VendorBill > itemList > item > customFieldList > customField
|VENDOR_CREDIT |VendorCredit > itemList > item > customFieldList > customField
|VENDOR_PAYMENT |VendorPayment > itemList > item > customFieldList > customField
|VENDOR_RETURN_AUTHORIZATION |VendorReturnAuthorization > itemList > item > customFieldList > customField
|WORK_ORDER |WorkOrder > itemList > item > customFieldList > customField
|===

=== Transaction Item Options

DataSense cannot detect NetSuite's Transaction Item Options.

=== Item Number Fields

DataSense cannot detect NetSuite's Item Number Fields.

=== Other Custom Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|ACCOUNT |Account > customFieldList > customField
|BIN |Bin > customFieldList > customField
|CLASSIFICATION |Classification > customFieldList > customField
|EXPENSE_CATEGORY |ExpenseCategory > customFieldList > customField
|ITEM_DEMAND_PLAN |ItemDemandPlan > customFieldList > customField
|ITEM_SUPPLY_PLAN |ItemSupplyPlan > customFieldList > customField
|LOCATION |Location > customFieldList > customField
|MANUFACTURING_COST_TEMPLATE |ManufacturingCostTemplate > customFieldList > customField
|MANUFACTURING_ROUTING |ManufacturingRouting > customFieldList > customField
|NOTE |Note > customFieldList > customField
|PROMOTION_CODE |PromotionCode > customFieldList > customField
|SUBSIDIARY |Subsidiary > customFieldList > customField
|===

== Resources

* Access the link:/release-notes/netsuite-about[NetSuite connector].
